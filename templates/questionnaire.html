{% extends "base.html" %}

{% block title %}Mental Health Assessment - Questionnaire{% endblock %}

{% block content %}
<div class="questionnaire-container">
    <!-- Header -->
    <div class="text-center mb-4">
        <h1 class="h2 mb-3">Mental Health Assessment</h1>
        <p class="text-muted">Please answer all questions honestly. This assessment takes approximately 5-10 minutes.</p>
    </div>

    <!-- Progress Bar -->
    <div class="mb-4">
        <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
        <small class="text-muted mt-1 d-block">Progress: Step <span id="current-step">1</span> of 4</small>
    </div>

    <!-- Step Indicators -->
    <div class="step-indicator mb-4">
        <div class="step active">
            <div class="step-circle">1</div>
            <small class="mt-2 d-block text-center">Demographics</small>
        </div>
        <div class="step">
            <div class="step-circle">2</div>
            <small class="mt-2 d-block text-center">Lifestyle</small>
        </div>
        <div class="step">
            <div class="step-circle">3</div>
            <small class="mt-2 d-block text-center">Mental Health</small>
        </div>
        <div class="step">
            <div class="step-circle">4</div>
            <small class="mt-2 d-block text-center">Review</small>
        </div>
    </div>

    <!-- Questionnaire Form -->
    <form id="questionnaire-form">
        <!-- Step 1: Demographics -->
        <div id="step-0" class="questionnaire-step">
            <div class="notebook-cell">
                <div class="cell-header">
                    <span class="cell-label">Demographics & Academic Information</span>
                </div>
                <div class="cell-content">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="age" class="form-label">Age *</label>
                            <input type="number" class="form-control" id="age" name="age" min="16" max="100" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="gender" class="form-label">Gender *</label>
                            <select class="form-control" id="gender" name="gender" required>
                                <option value="">Select Gender</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="non_binary">Non-binary</option>
                                <option value="prefer_not_to_say">Prefer not to say</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="academic_year" class="form-label">Academic Year *</label>
                            <select class="form-control" id="academic_year" name="academic_year" required>
                                <option value="">Select Year</option>
                                <option value="1">First Year</option>
                                <option value="2">Second Year</option>
                                <option value="3">Third Year</option>
                                <option value="4">Fourth Year</option>
                                <option value="graduate">Graduate Student</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="major" class="form-label">Field of Study *</label>
                            <select class="form-control" id="major" name="major" required>
                                <option value="">Select Field</option>
                                <option value="engineering">Engineering</option>
                                <option value="medicine">Medicine/Health Sciences</option>
                                <option value="business">Business/Management</option>
                                <option value="arts">Arts/Humanities</option>
                                <option value="science">Science/Mathematics</option>
                                <option value="computer_science">Computer Science</option>
                                <option value="social_sciences">Social Sciences</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="cgpa" class="form-label">CGPA/GPA *</label>
                            <input type="number" class="form-control" id="cgpa" name="cgpa" min="0" max="10" step="0.1" required>
                            <small class="text-muted">On a 10.0 scale</small>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="residential_status" class="form-label">Residential Status *</label>
                            <select class="form-control" id="residential_status" name="residential_status" required>
                                <option value="">Select Status</option>
                                <option value="on_campus">On Campus/Hostel</option>
                                <option value="off_campus">Off Campus/Rental</option>
                                <option value="with_family">Living with Family</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2: Lifestyle Factors -->
        <div id="step-1" class="questionnaire-step" style="display: none;">
            <div class="notebook-cell">
                <div class="cell-header">
                    <span class="cell-label">Lifestyle & Behavioral Factors</span>
                </div>
                <div class="cell-content">
                    <div class="mb-4">
                        <label for="sleep_duration" class="form-label">Average Sleep Duration (hours per night) *</label>
                        <input type="range" class="form-range" id="sleep_duration" name="sleep_duration" min="3" max="12" value="7" required>
                        <div class="d-flex justify-content-between text-muted small">
                            <span>3 hours</span>
                            <span id="sleep_duration-value">7</span>
                            <span>12 hours</span>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="form-label">Dietary Habits *</label>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="dietary_habits" id="diet_excellent" value="5" required>
                                    <label class="form-check-label" for="diet_excellent">Excellent (regular, balanced meals)</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="dietary_habits" id="diet_good" value="4" required>
                                    <label class="form-check-label" for="diet_good">Good (mostly regular meals)</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="dietary_habits" id="diet_average" value="3" required>
                                    <label class="form-check-label" for="diet_average">Average (irregular timing)</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="dietary_habits" id="diet_poor" value="2" required>
                                    <label class="form-check-label" for="diet_poor">Poor (frequently skip meals)</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="dietary_habits" id="diet_very_poor" value="1" required>
                                    <label class="form-check-label" for="diet_very_poor">Very Poor (mostly junk food/skipping)</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label for="physical_activity" class="form-label">Physical Activity Level *</label>
                        <select class="form-control" id="physical_activity" name="physical_activity" required>
                            <option value="">Select Activity Level</option>
                            <option value="5">Very Active (daily exercise/sports)</option>
                            <option value="4">Active (3-4 times per week)</option>
                            <option value="3">Moderate (1-2 times per week)</option>
                            <option value="2">Low (occasional activity)</option>
                            <option value="1">Sedentary (no regular activity)</option>
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label for="social_connectedness" class="form-label">Social Connectedness *</label>
                        <select class="form-control" id="social_connectedness" name="social_connectedness" required>
                            <option value="">Rate your social connections</option>
                            <option value="5">Very Connected (strong friend network)</option>
                            <option value="4">Well Connected (good social circle)</option>
                            <option value="3">Moderately Connected (some close friends)</option>
                            <option value="2">Somewhat Isolated (few close connections)</option>
                            <option value="1">Very Isolated (feel lonely often)</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="screen_time" class="form-label">Daily Screen Time (hours) *</label>
                        <input type="range" class="form-range" id="screen_time" name="screen_time" min="1" max="16" value="6" required>
                        <div class="d-flex justify-content-between text-muted small">
                            <span>1 hour</span>
                            <span id="screen_time-value">6</span>
                            <span>16+ hours</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 3: Mental Health & Psychological Factors -->
        <div id="step-2" class="questionnaire-step" style="display: none;">
            <div class="notebook-cell">
                <div class="cell-header">
                    <span class="cell-label">Mental Health & Psychological Factors</span>
                </div>
                <div class="cell-content">
                    <div class="mb-4">
                        <label class="form-label">Family History of Mental Illness *</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="family_history" id="family_yes" value="1" required>
                            <label class="form-check-label" for="family_yes">Yes, there is a family history</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="family_history" id="family_no" value="0" required>
                            <label class="form-check-label" for="family_no">No family history</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="family_history" id="family_unknown" value="0.5" required>
                            <label class="form-check-label" for="family_unknown">Unknown/Unsure</label>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label for="financial_stress" class="form-label">Financial Stress Level *</label>
                        <select class="form-control" id="financial_stress" name="financial_stress" required>
                            <option value="">Rate your financial stress</option>
                            <option value="1">No Financial Stress</option>
                            <option value="2">Minimal Financial Concerns</option>
                            <option value="3">Moderate Financial Pressure</option>
                            <option value="4">High Financial Stress</option>
                            <option value="5">Severe Financial Difficulties</option>
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label for="academic_pressure" class="form-label">Perceived Academic Pressure *</label>
                        <select class="form-control" id="academic_pressure" name="academic_pressure" required>
                            <option value="">Rate your academic pressure</option>
                            <option value="1">Very Low Pressure</option>
                            <option value="2">Low Pressure</option>
                            <option value="3">Moderate Pressure</option>
                            <option value="4">High Pressure</option>
                            <option value="5">Overwhelming Pressure</option>
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label class="form-label">History of Mental Health Treatment *</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="treatment_history" id="treatment_current" value="2" required>
                            <label class="form-check-label" for="treatment_current">Currently receiving treatment</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="treatment_history" id="treatment_past" value="1" required>
                            <label class="form-check-label" for="treatment_past">Have received treatment in the past</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="treatment_history" id="treatment_none" value="0" required>
                            <label class="form-check-label" for="treatment_none">Never received treatment</label>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="coping_mechanisms" class="form-label">Primary Coping Mechanisms *</label>
                        <select class="form-control" id="coping_mechanisms" name="coping_mechanisms" required>
                            <option value="">Select your primary coping strategy</option>
                            <option value="5">Healthy coping (exercise, hobbies, social support)</option>
                            <option value="4">Mostly healthy with some unhealthy habits</option>
                            <option value="3">Mixed healthy and unhealthy coping</option>
                            <option value="2">Mostly unhealthy coping (avoidance, isolation)</option>
                            <option value="1">Unhealthy coping (substance use, self-harm)</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 4: Review -->
        <div id="step-3" class="questionnaire-step" style="display: none;">
            <div class="notebook-cell">
                <div class="cell-header">
                    <span class="cell-label">Review Your Responses</span>
                </div>
                <div class="cell-content">
                    <h4 class="mb-3">Review Your Responses</h4>
                    <p class="text-muted mb-4">
                        Please review your responses below. You can go back to previous steps to make changes if needed.
                    </p>

                    <!-- Demographics Review -->
                    <div class="review-section mb-4">
                        <h5 class="review-section-title">Demographics & Academic Information</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Age:</strong> <span id="review-age"></span></p>
                                <p><strong>Gender:</strong> <span id="review-gender"></span></p>
                                <p><strong>Academic Year:</strong> <span id="review-academic-year"></span></p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Field of Study:</strong> <span id="review-major"></span></p>
                                <p><strong>CGPA/GPA:</strong> <span id="review-cgpa"></span> / 10.0</p>
                                <p><strong>Residential Status:</strong> <span id="review-residential-status"></span></p>
                            </div>
                        </div>
                    </div>

                    <!-- Lifestyle Review -->
                    <div class="review-section mb-4">
                        <h5 class="review-section-title">Lifestyle & Behavioral Factors</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Sleep Duration:</strong> <span id="review-sleep-duration"></span></p>
                                <p><strong>Dietary Habits:</strong> <span id="review-dietary-habits"></span></p>
                                <p><strong>Physical Activity:</strong> <span id="review-physical-activity"></span></p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Social Connectedness:</strong> <span id="review-social-connectedness"></span></p>
                                <p><strong>Screen Time:</strong> <span id="review-screen-time"></span></p>
                            </div>
                        </div>
                    </div>

                    <!-- Mental Health Review -->
                    <div class="review-section mb-4">
                        <h5 class="review-section-title">Mental Health & Psychological Factors</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Family History:</strong> <span id="review-family-history"></span></p>
                                <p><strong>Financial Stress:</strong> <span id="review-financial-stress"></span></p>
                                <p><strong>Academic Pressure:</strong> <span id="review-academic-pressure"></span></p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Treatment History:</strong> <span id="review-treatment-history"></span></p>
                                <p><strong>Coping Mechanisms:</strong> <span id="review-coping-mechanisms"></span></p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-info">
                        <h6><i class="fas fa-info-circle me-2"></i>Privacy Notice</h6>
                        <p class="mb-0">
                            Your responses are processed securely and are not stored permanently. 
                            This assessment is for informational purposes only and should not replace 
                            professional medical advice.
                        </p>
                    </div>
                    
                    <div class="alert alert-warning">
                        <h6><i class="fas fa-exclamation-triangle me-2"></i>Important Disclaimer</h6>
                        <p class="mb-0">
                            If you are experiencing thoughts of self-harm or suicide, please reach out 
                            for immediate help. Contact emergency services or a mental health crisis hotline 
                            in your area.
                        </p>
                    </div>
                    
                    <div class="form-check mb-4">
                        <input class="form-check-input" type="checkbox" id="consent" name="consent" required>
                        <label class="form-check-label" for="consent">
                            I understand this is not a medical diagnosis and agree to the terms of use *
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Buttons -->
        <div class="nav-buttons">
            <button type="button" id="prev-btn" class="btn btn-secondary" style="display: none;">
                <i class="fas fa-arrow-left me-2"></i>Previous
            </button>
            <div class="ms-auto">
                <button type="button" id="next-btn" class="btn btn-primary">
                    Next<i class="fas fa-arrow-right ms-2"></i>
                </button>
                <button type="button" id="submit-btn" class="btn btn-success" style="display: none;">
                    <i class="fas fa-check me-2"></i>Get My Assessment
                </button>
            </div>
        </div>
    </form>
</div>

<!-- Alert Container -->
<div id="alert-container"></div>
{% endblock %}

{% block extra_scripts %}
<script>
// Update step indicators and progress
function updateCurrentStepDisplay() {
    document.getElementById('current-step').textContent = currentStep + 1;
}

// Override the showStep function to update the display
const originalShowStep = showStep;
showStep = function(step) {
    originalShowStep(step);
    updateCurrentStepDisplay();
};
</script>
{% endblock %}